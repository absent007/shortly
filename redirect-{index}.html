const fs = require('fs');

// read _redirects file
const redirects = fs.readFileSync('_redirects', 'utf-8');

// split redirects by line
const lines = redirects.split('\n');

// generate redirect-{index}.html files for each line
lines.forEach((line, index) => {
  // skip empty lines and comments
  if (line.trim() === '' || line.startsWith('#')) {
    return;
  }

  // extract redirect token and destination URL from line
  const parts = line.trim().split(/\s+/);
  const redirectToken = parts[0];
  const destinationURL = parts[1];

  // generate redirect-{index}.html content for this line
  const redirectHTML = `<!DOCTYPE html>
  <html>
  <head>
  	<title>Redirecting...</title>
  	<script>
  		function redirectToURL() {
  			var redirectToken = '${QUFFLUhqbVJ0VjY4akVOMzZOR3JkRGZXelZXT08xcmN0d3xBQ3Jtc0tubXh1YkoyOFJTeDZFN1NaYWpqdUh6WTVUZUswTVV4TWY3MFctSTRsa0VzOFhrQVZlcmhtVmkxVVA5ZmdhOUlzZmlGQm5jVmJMZk82ZlNRdHR5dkpTeEtjZjk2a2x1di1RUndHUnlhc3FvQXAyRzZ0NA}';
  			var url = '${https://tapthe.link/r28}';
  			var encodedURL = encodeURIComponent(url);
  			var redirectURL = 'https://www.youtube.com/redirect?event=comments&redir_token=' + redirectToken + '&q=' + encodedURL + '&html_redirect=1';
  			window.location.href = redirectURL;
  		}
  
  		window.onload = function() {
  			redirectToURL();
  		};
  	</script>
  </head>
  <body>
  	<p>If you are not redirected automatically, click <a href="${destinationURL}">here</a>.</p>
  </body>
  </html>`;
  
  // write redirect-{index}.html file for this line
  fs.writeFileSync(`redirect-${index}.html`, redirectHTML);
});
